<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Machining Calculator</title>
	<link rel="icon" type="image/png" href="bulbico.svg">
    <!-- Tailwind CSS CDN for easy styling and responsiveness -->
    <xx-script src="https://cdn.tailwindcss.com"></xx-script>
    <script src="tailwind.js"></script>
    <script src="const.js"></script>
    <style>
        /* Custom font for better aesthetics */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* Light gray background */
        }
        /* Ensure buttons are touch-friendly */
        .input-button {
            padding: 0.75rem 1.25rem; /* Ample padding for touch targets */
            margin: 0.25rem; /* Space between buttons */
            border-radius: 0.5rem; /* Rounded corners */
            transition: background-color 0.2s, transform 0.1s;
        }
        .input-button.selected {
            background-color: #3b82f6; /* Blue for selected button */
            color: white;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .input-button:active {
            transform: scale(0.98); /* Slight press effect */
        }
        .output-box {
            background-color: #e2e8f0; /* Lighter gray for output */
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            min-height: 2.5rem; /* Ensure consistent height */
            display: flex;
            align-items: center;
            justify-content: center;
        }
fraction {
  display: inline-grid;

  grid-template-columns: 1fr;
  grid-template-rows: 1fr 1fr;

  font-size: 0.8em; // You can change fraction size here. I recommend 0.5em ~ 0.8em
  vertical-align: top;
}

numer {
  border-bottom: 1px solid;
}
                        .warning-message {
            background-color: #fffbeb; /* Light yellow background */
            border-left: 4px solid #f59e0b; /* Orange left border */
            color: #d97706; /* Darker orange text */
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem; /* Space below the warning */
            font-size: 0.9rem;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">
    <div class="bg-white p-6 sm:p-8 rounded-lg shadow-xl w-full max-w-md md:max-w-lg lg:max-w-xl">

        <a href="lathe.html" class="absolute top-4 left-4 p-2 pl-3 rounded-full bg-blue-100 hover:bg-blue-200 text-blue-600 transition-colors duration-200 shadow-md flex items-center text-sm font-medium">
            <!-- Simple Left Arrow Icon -->
            <svg class="w-5 h-5 mr-1" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="m15 18-6-6 6-6"/>
            </svg>
            Turning
        </a>
	<a href="mach_adv.html"
           class="absolute top-4 right-4 bg-gray-200 hover:bg-gray-300 text-gray-800 text-sm font-semibold py-2 px-4 rounded-lg shadow-md transition-colors duration-200">
            Advanced
        </a>

        <div class="flex items-center justify-center mb-6">
            <h1 class="text-2xl sm:text-3xl font-bold text-center text-gray-800">Machining Calculator</h1>
        </div>

        <!-- Input Section -->
        <div class="mb-8 space-y-6">
            <!-- Tool Diameter Input -->
            <div>
                    <label class="block text-gray-700 text-lg font-semibold mb-3">Tool Diameter:</label>

                    <!-- Preset Buttons -->
                    <div id="diameter-input" class="flex flex-wrap gap-2 mb-2">
                    <button class="input-button bg-gray-200 hover:bg-gray-300 text-gray-800" data-value="0.0787402">2mm</button>
                    <button class="input-button bg-gray-200 hover:bg-gray-300 text-gray-800" data-value="0.125"><fraction> <numer>1</numer>8</fraction>&quot;</button>
                    <button class="input-button bg-gray-200 hover:bg-gray-300 text-gray-800" data-value="0.157">4mm</button>
                    <button class="input-button bg-gray-200 hover:bg-gray-300 text-gray-800" data-value="0.25"><fraction> <numer>1</numer>4</fraction>&quot;</button>
                    <button class="input-button bg-gray-200 hover:bg-gray-300 text-gray-800" data-value="0.375"><fraction> <numer>3</numer>8</fraction>&quot;</button>
                    <button class="input-button bg-gray-200 hover:bg-gray-300 text-gray-800" data-value="0.5"><fraction> <numer>1</numer>2</fraction>&quot;</button>
                    <button class="input-button bg-gray-200 hover:bg-gray-300 text-gray-800" data-value="0.625"><fraction> <numer>5</numer>8</fraction>&quot;</button>
                    <button class="input-button bg-gray-200 hover:bg-gray-300 text-gray-800" data-value="0.75"><fraction> <numer>3</numer>4</fraction>&quot;</button>
                    <button class="input-button bg-gray-200 hover:bg-gray-300 text-gray-800" data-value="0.875"><fraction> <numer>7</numer>8</fraction>&quot;</button>
                    <button class="input-button bg-gray-200 hover:bg-gray-300 text-gray-800" data-value="1">1&quot;</button>
                        <button id="other-btn" class="bg-blue-200 hover:bg-blue-300 text-blue-800 px-3 py-1">Other...</button>
                    </div>

                    <!-- Custom Input -->
                    <div id="custom-diameter" class="hidden mt-2 flex items-center gap-2">
                        <input id="custom-value" type="number" step="0.001" class="border rounded px-2 py-1 w-24" placeholder="Value">
                        <select id="custom-unit" class="border rounded px-2 py-1">
                            <option value="in">inches</option>
                            <option value="mm">mm</option>
                        </select>
                        <button id="custom-submit" class="bg-green-200 hover:bg-green-300 text-green-800 px-3 py-1 rounded">Set</button>
                        <button id="custom-cancel" class="bg-gray-200 hover:bg-gray-300 text-gray-800 px-3 py-1 rounded">Cancel</button>
                    </div>
                </div>

            <!-- Material Type Input -->
            <div>
                <label class="block text-gray-700 text-lg font-semibold mb-3">Material Type:</label>
                <div id="material-input" class="flex flex-wrap justify-center sm:justify-start">
                    <button class="input-button bg-gray-200 hover:bg-gray-300 text-gray-800 selected" data-value="aluminum">Aluminum</button>
                    <button class="input-button bg-gray-200 hover:bg-gray-300 text-gray-800" data-value="steel">Steel</button>
                    <button class="input-button bg-gray-200 hover:bg-gray-300 text-gray-800" data-value="stainless">Stainless</button>
                    <button class="input-button bg-gray-200 hover:bg-gray-300 text-gray-800" data-value="brass">Brass</button>
                    <button class="input-button bg-gray-200 hover:bg-gray-300 text-gray-800" data-value="plastic">Plastic</button>
                </div>
            </div>

            <!-- Number of Flutes Input -->
            <div>
                <label class="block text-gray-700 text-lg font-semibold mb-3">Number of Flutes:</label>
                <div id="flutes-input" class="flex flex-wrap justify-center sm:justify-start">
                    <button class="input-button bg-gray-200 hover:bg-gray-300 text-gray-800 selected" data-value="1">1 Flute</button>
                    <button class="input-button bg-gray-200 hover:bg-gray-300 text-gray-800 selected" data-value="2">2 Flutes</button>
                    <button class="input-button bg-gray-200 hover:bg-gray-300 text-gray-800" data-value="3">3 Flutes</button>
                    <button class="input-button bg-gray-200 hover:bg-gray-300 text-gray-800" data-value="4">4 Flutes</button>
                    <button class="input-button bg-gray-200 hover:bg-gray-300 text-gray-800" data-value="6">6 Flutes</button>
                </div>
            </div>

            <!-- Machine Type Input -->
            <div>
                <label class="block text-gray-700 text-lg font-semibold mb-3">Machine Type:</label>
                <div id="machine-type-input" class="flex flex-wrap justify-center sm:justify-start">
                    <button class="input-button bg-gray-200 hover:bg-gray-300 text-gray-800 selected" data-value="bridgeport">Bridgeport</button>
                    <button class="input-button bg-gray-200 hover:bg-gray-300 text-gray-800" data-value="tormach">Tormach</button>
                    <button class="input-button bg-gray-200 hover:bg-gray-300 text-gray-800" data-value="liltormy">Li'l Tormy</button>
                    <button class="input-button bg-gray-200 hover:bg-gray-300 text-gray-800" data-value="other">Other</button>
                </div>
            </div>
        </div>


        <hr />
        <br />
        <!-- Output Section -->
        <h2 class="text-xl sm:text-2xl font-bold text-center text-gray-800 mb-4">Calculated Values</h2>

        <!-- Small Tool Warning Message -->
        <div id="small-tool-warning" class="warning-message hidden">
            <!-- Message will be inserted here by JavaScript -->
        </div>

        <!-- Traditional Calculations Row -->
        <div class="flex items-center justify-between mb-2">
            <div>
                <h3 class="text-lg sm:text-xl font-semibold text-gray-700" style="margin-bottom:0px">General Milling (Traditional)</h3>
                <p id="stepovermessage" class="text-sm sm:text-sm text-gray-700">Cut with stepover of 40-60% of tool</p>
            </div>
            <img src="tradl.png" alt="Slotting Icon" class="w-12 h-auto xx-sm:w-16 sm:h-auto">
        </div>

        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6">
            <!-- RPM Output -->
            <div>
                <label class="block text-gray-700 text-md font-semibold mb-2">Calculated RPM:</label>
                <div id="output-rpm" class="output-box text-blue-700 font-bold">0</div>
            </div>

            <!-- Feed Rate Output -->
            <div>
                <label class="block text-gray-700 text-md font-semibold mb-2">Calculated Feed Rate (IPM):</label>
                <div id="output-feedrate" class="output-box text-blue-700 font-bold">0</div>
            </div>
        </div>

        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6">
            <!-- RPM Output -->
            <div>
                <label class="block text-gray-700 text-md font-semibold mb-2">Stepover:</label>
                <div id="stepover" class="output-box text-blue-700 font-bold">0</div>
            </div>

            <div>
                <label class="block text-gray-700 text-md font-semibold mb-2">Depth of Cut (ZDOC):</label>
                <div id="zdoc" class="output-box text-blue-700 font-bold">0</div>
            </div>
        </div>

        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6">
            <div>
                <label class="block text-gray-700 text-md font-semibold mb-2">Z Feed (Plunge Rate) IPM:</label>
                <div id="zfeed" class="output-box text-blue-700 font-bold">0</div>
            </div>
        </div>
        <hr />
        <br />
        <!-- Slotting/First Pass Calculations Row -->
        <div class="flex items-center justify-between mb-2">
            <div>
                <h3 class="text-lg sm:text-xl font-semibold text-gray-700" style="margin-bottom:0px">Slotting (Conservative)</h3>
                <p class="text-sm sm:text-sm text-gray-700">First pass, cutting with whole tool</p>
            </div>
            <img src="slotting.png" alt="Slotting Icon" class="w-12 h-auto xx-sm:w-16 sm:h-auto">
        </div>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
            <!-- Slotting RPM Output -->
            <div>
                <label class="block text-gray-700 text-md font-semibold mb-2">Slotting RPM:</label>
                <div id="output-rpm-slotting" class="output-box text-red-700 font-bold">0</div>
            </div>

            <!-- Slotting Feed Rate Output -->
            <div>
                <label class="block text-gray-700 text-md font-semibold mb-2">Slotting Feed Rate (IPM):</label>
                <div id="output-feedrate-slotting" class="output-box text-red-700 font-bold">0</div>
            </div>
        </div>

        <br />
        <hr />
        <br />
        <!-- Slotting/First Pass Calculations Row -->
        <div class="flex items-center justify-between mb-2">
            <div>
                <h3 class="text-lg sm:text-xl font-semibold text-gray-700" style="margin-bottom:0px">Drilling</h3>
            </div>
            <img src="drilling.png" alt="Slotting Icon" class="w-12 h-auto xx-sm:w-16 sm:h-auto">
        </div>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
            <!-- Slotting RPM Output -->
            <div>
                <label class="block text-gray-700 text-md font-semibold mb-2">Drilling RPM:</label>
                <div id="output-rpm-drilling" class="output-box text-green-700 font-bold">0</div>
            </div>

            <!-- Slotting Feed Rate Output -->
            <div>
                <label class="block text-gray-700 text-md font-semibold mb-2">Z-Feed Rate (IPM):</label>
                <div id="output-feedrate-drilling" class="output-box text-green-700 font-bold">0</div>
            </div>
        </div>
    </div>
    <script>
   // Variables to store selected input values
        let selectedDiameter = 0.25; // Default diameter
        let selectedMaterial = 'aluminum'; // Default material
        let selectedFlutes = 2; // Default flutes
        let selectedMachineType = 'bridgeport'; // Set default to match the selected button in HTML




        // Function to update the selected state of buttons within a group
        function updateButtonSelection(containerId, selectedValue) {
            const container = document.getElementById(containerId);
            const buttons = container.querySelectorAll('button');
            buttons.forEach(button => {
                if (button.dataset.value === String(selectedValue)) {
                    button.classList.add('selected');
                } else {
                    button.classList.remove('selected');
                }
            });
        }

        // Function to perform calculations and update outputs
        function updateOutputs() {
            // Get properties for the selected material
            //const material = materialProperties[selectedMaterial];
            //const sfm = material.sfmSliderRange.default;
            //const ipt = material.iptSliderRange.default / IPT_SCALE_FACTOR;

            const diameterAdjustedProps = getDiameterAdjustedProperties(selectedMaterial, selectedDiameter);
            const sfm = diameterAdjustedProps.sfm;
            const ipt = diameterAdjustedProps.ipt; // This is the unscaled IPT

            // Get RPM cap for the selected machine type
            const rpmCap = machineLimitations[selectedMachineType].rpmCap;

            // --- Traditional Milling Calculations ---
            // Calculate base RPM
            const baseCalculatedRPM = (sfm * 3.82) / selectedDiameter;
            // Apply RPM cap
            const finalCalculatedRPM = Math.min(baseCalculatedRPM, rpmCap);
            document.getElementById('output-rpm').textContent = finalCalculatedRPM.toFixed(0);

            // Calculate Feed Rate using the final (potentially capped) RPM
            const calculatedFeedRate = finalCalculatedRPM * selectedFlutes * ipt;
            document.getElementById('output-feedrate').textContent = calculatedFeedRate.toFixed(1);

            // --- Slotting/First Pass Calculations (Conservative) ---
            // Apply the global reduction factors to SFM and IPT for slotting
            const sfmSlotting = sfm * globalSfmReductionFactor;
            const iptSlotting = ipt * globalIptReductionFactor;

            // Calculate base Slotting RPM
            const baseCalculatedRPMSlotting = (sfmSlotting * 3.82) / selectedDiameter;
            // Apply RPM cap to slotting RPM
            const finalCalculatedRPMSlotting = Math.min(baseCalculatedRPMSlotting, rpmCap);
            document.getElementById('output-rpm-slotting').textContent = finalCalculatedRPMSlotting.toFixed(0);

            // Calculate Slotting Feed Rate using the final (potentially capped) Slotting RPM
            const calculatedFeedRateSlotting = finalCalculatedRPMSlotting * selectedFlutes * iptSlotting;
            document.getElementById('output-feedrate-slotting').textContent = calculatedFeedRateSlotting.toFixed(1);

            // Drills
            var drills = getDrillSpeeds(selectedDiameter,selectedMaterial);
            document.getElementById('output-rpm-drilling').textContent = drills.rpm.toFixed(0);
            document.getElementById('output-feedrate-drilling').textContent = drills.ipm.toFixed(1);

            // --- Small Tool Warning Logic ---
            var smallToolWarning = document.getElementById('small-tool-warning');
                if (selectedDiameter <= SMALL_TOOL_THRESHOLD) {
                    const depth20 = (selectedDiameter * 0.20).toFixed(4);
                    const depth15 = (selectedDiameter * 0.15).toFixed(4);
                    smallToolWarning.innerHTML = `<strong>Small Tool Warning:</strong> For tool diameters &le; ${SMALL_TOOL_THRESHOLD.toFixed(3)}", consider a depth of pass between ${depth15}" (15%) and ${depth20}" (20%) of the cutter diameter. Use with caution.`;
                    smallToolWarning.classList.remove('hidden');
                } else {
                    smallToolWarning.classList.add('hidden');
                }

           // Stepover calculation and message 
            var stepover = (selectedDiameter * 0.40)
            var zdoc = getDepthOfCut(selectedDiameter);

            document.getElementById('zdoc').textContent = zdoc.recommended.toFixed(3)+"\"";
            document.getElementById('stepover').textContent = stepover.toFixed(3)+"\"";
            document.getElementById('zfeed').textContent = (calculatedFeedRate * 0.25).toFixed(1);
        }
        // end UpdateOutputs

        // Event listener for Tool Diameter buttons
        document.getElementById('diameter-input').addEventListener('click', (event) => {
             const clickedButton = event.target.closest('button');
              if (clickedButton) {
                const selectedValue = clickedButton.dataset.value;
                console.log('Raw data-value from currentTarget:', selectedValue); // THIS IS THE KEY: See what this logs

                selectedDiameter = parseFloat(selectedValue);
                updateButtonSelection('diameter-input', selectedDiameter);
                updateOutputs();
             }
        });

        // Event listener for Material Type buttons
        document.getElementById('material-input').addEventListener('click', (event) => {
            if (event.target.tagName === 'BUTTON') {
                selectedMaterial = event.target.dataset.value;
                updateButtonSelection('material-input', selectedMaterial);
                updateOutputs();
            }
        });

        // Event listener for Number of Flutes buttons
        document.getElementById('flutes-input').addEventListener('click', (event) => {
            if (event.target.tagName === 'BUTTON') {
                selectedFlutes = parseInt(event.target.dataset.value);
                updateButtonSelection('flutes-input', selectedFlutes);
                updateOutputs();
            }
        });

        // Event listener for Machine Type buttons
        document.getElementById('machine-type-input').addEventListener('click', (event) => {
            if (event.target.tagName === 'BUTTON') {selectedMachineType
                selectedMachineType = event.target.dataset.value;
                updateButtonSelection('machine-type-input', selectedMachineType);
                updateOutputs();
            }
        });

        // Initial setup and calculation on page load
        document.addEventListener('DOMContentLoaded', () => {
            // Set initial button selections based on default values
            updateButtonSelection('diameter-input', selectedDiameter);
            updateButtonSelection('material-input', selectedMaterial);
            updateButtonSelection('flutes-input', selectedFlutes);
            updateButtonSelection('machine-type-input', selectedMachineType); // Set initial machine type selection
            updateOutputs(); // Perform initial calculation
        });

        // New Custom Size Input

            const buttons = document.querySelectorAll('#diameter-input .input-button');
const otherBtn = document.getElementById('other-btn');
const customDiv = document.getElementById('custom-diameter');
const customSubmit = document.getElementById('custom-submit');
const customCancel = document.getElementById('custom-cancel');

buttons.forEach(btn => {
    btn.addEventListener('click', () => {
        buttons.forEach(b => b.classList.remove('bg-gray-400')); // clear previous highlight
        btn.classList.add('bg-gray-400'); // highlight current
        customDiv.classList.add('hidden'); // hide custom input
    });
});

otherBtn.addEventListener('click', () => {
    customDiv.classList.remove('hidden');  // show custom input
    buttons.forEach(b => b.classList.remove('bg-gray-400')); // clear button highlight
});

customSubmit.addEventListener('click', () => {
    const value = parseFloat(document.getElementById('custom-value').value);
    const unit = document.getElementById('custom-unit').value;
    if (!isNaN(value)) {
        const valueInInches = unit === 'mm' ? value / 25.4 : value;
        //alert(`Custom diameter set: ${valueInInches.toFixed(4)} in`);
        // Optionally store value in a hidden field or state
        selectedDiameter = parseFloat(valueInInches);
        //        updateButtonSelection('diameter-input', selectedDiameter);
        updateOutputs();
    }
});

customCancel.addEventListener('click', () => {
    customDiv.classList.add('hidden'); // hide custom input
});

    </script>
</body>
</html>

